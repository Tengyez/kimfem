<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>POPKIM</title>

<style>
body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    margin: 0;
    background-color: #bdaa90;
    font-family: 'Arial Black', 'Arial', sans-serif;
    overflow: hidden;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
}

#title {
    font-size: clamp(3rem, 10vw, 5rem);
    color: white;
    text-shadow: 6px 6px 0px #333;
    margin: 0;
    letter-spacing: 2px;
}

#counter {
    font-size: clamp(4rem, 12vw, 6rem);
    color: white;
    text-shadow: 4px 4px 0px #333;
    margin-bottom: 20px;
}

#pop-img {
    max-height: 60vh;
    max-width: 90vw;
    cursor: pointer;
    object-fit: contain;
    transition: transform 0.05s ease-in-out;
}

.pushing {
    transform: scale(0.92);
}
</style>
</head>

<body>

<h1 id="title">POPKIM</h1>
<div id="counter">0</div>

<img id="pop-img" src="./images/unpoppedkim.png" alt="POPKIM">

<script>

const imgElement = document.getElementById('pop-img');
const counterElement = document.getElementById('counter');

const soundPath = './images/KimmySound.mp3';
const imgUnpopped = './images/unpoppedkim.png';
const imgPopped = './images/poppedkim.png';

let count = 0;

const preloadImg = new Image();
preloadImg.src = imgPopped;


const POOL_SIZE = 30;
const audioPool = [];
let audioIndex = 0;

for (let i = 0; i < POOL_SIZE; i++) {
    const audio = new Audio(soundPath);
    audio.preload = "auto";
    audio.volume = 1;
    audioPool.push(audio);
}

function playPopSound() {
    const sound = audioPool[audioIndex];
    sound.currentTime = 0;
    sound.play();

    audioIndex++;
    if (audioIndex >= POOL_SIZE) audioIndex = 0;
}


function startPop(e) {
    if (e) e.preventDefault();

    count++;
    counterElement.innerText = count;

    imgElement.src = imgPopped;
    imgElement.classList.add('pushing');

    playPopSound();

    clearTimeout(popTimeout);
    popTimeout = setTimeout(() => {
        imgElement.src = imgUnpopped;
        imgElement.classList.remove('pushing');
    }, 50);
}


function endPop() {
    imgElement.src = imgUnpopped;
    imgElement.classList.remove('pushing');
}


imgElement.addEventListener('mousedown', startPop);
window.addEventListener('mouseup', endPop);

imgElement.addEventListener('touchstart', startPop, { passive: false });
window.addEventListener('touchend', endPop);

window.addEventListener('keydown', (e) => {
    if (e.code === "Space") startPop();
});
window.addEventListener('keyup', (e) => {
    if (e.code === "Space") endPop();
});

console.log("POPKIM ready for spam clicking.");

</script>
</body>
</html>
